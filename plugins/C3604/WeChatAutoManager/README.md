# 微信自动管理插件 WeChatAutoManager

![Version](https://img.shields.io/badge/版本-v1.0.1-blue) ![Platform](https://img.shields.io/badge/平台-WAuxiliary-green) ![Language](https://img.shields.io/badge/语言-Java-orange) ![API](https://img.shields.io/badge/API-v1.2.3.r722.c2ba115-red)

一个功能完整的微信自动化管理插件，基于[WAuxiliary](https://github.com/HdShare/WAuxiliary_Public)框架开发，集成了好友管理、群邀请、群提示和状态监控四大核心功能，具备完整的群人员监控和智能日志系统。

> 🎯 **框架说明**: 本插件基于[WAuxiliary](https://github.com/HdShare/WAuxiliary_Public)微信辅助框架开发，WAuxiliary是一个强大的微信Xposed模块，为微信提供了丰富的API接口和插件开发能力。

## 🚀 核心功能

### 🤝 智能好友管理
- ✅ **自动通过好友申请** - 无需手动处理，自动通过所有好友申请
- 📨 **个性化欢迎消息** - 异步发送定制化欢迎消息，引导用户进群
- 🔄 **异步处理机制** - 避免阻塞主线程，确保处理流畅
- 📝 **详细申请记录** - 记录好友申请场景、用户信息和处理状态

### 🎯 智能群邀请系统
- 🔍 **关键词触发** - 用户发送自定义关键词自动触发群邀请流程
- 🎲 **随机群组选择** - 随机选择可用群组，均衡分配群成员
- 👥 **实时人数检查** - 自动检查群成员数量，避免邀请到满员群(500人)
- 💬 **确认消息回复** - 邀请发送后自动回复确认消息和注意事项
- ⚠️ **异常处理** - 完整的错误处理和用户提示机制

### 💬 群成员动态提示
- 🎉 **智能入群欢迎** - 新成员加入时自动发送个性化欢迎消息
- 😢 **退群告别提醒** - 成员离开时发送告别消息（可配置开关）
- 📢 **@新成员功能** - 支持@新加入的群成员，增强互动性
- 🔧 **灵活配置开关** - 可独立控制入群/退群提示功能
- 🎨 **消息模板变量** - 支持{userName}、{userWxid}动态变量替换

### 📊 完整监控日志系统
- 🏷️ **三级分类日志** - #信息、#功能、#报错分级记录
- 🏘️ **群名称映射** - 显示友好的群名称替代冗长的群ID
- 📋 **详细操作记录** - 可选的详细日志记录所有操作信息
- ⏰ **实时状态监控** - 实时记录插件活动和群组状态
- 📈 **立即启动日志** - 插件加载3秒后立即显示完整初始化信息

### 🆕 群人员监控功能
- 📊 **实时人数统计** - 显示每个群的当前人数/最大人数
- 📈 **使用率分析** - 计算群使用率百分比
- 🚦 **状态可视化** - 🟢可用 / 🔴已满 / ❌异常 状态显示
- 📋 **汇总统计** - 总群数、可用群数、已满群数、总人数统计
- 💡 **平均人数** - 自动计算平均群人数

### 🆕 实时状态查询
- 💬 **`/info` 命令** - 在日志群输入`/info`即时查看插件状态
- 🔄 **实时数据更新** - 每次查询都获取最新的群组人数信息
- 📊 **完整状态报告** - 显示配置状态、群组信息和人员统计

## 📦 安装配置

### 环境要求
- **WAuxiliary框架**: v1.2.3.r722.c2ba115 或更高版本 ([下载地址](https://github.com/HdShare/WAuxiliary_Public/releases))
- **Android系统**: 支持微信的Android设备
- **微信版本**: 理论适配 8.0.33~8.0.60 国内与PLAY版本
- **Xposed框架**: 需要已安装并激活Xposed或类似框架

### 快速安装

1. **下载插件文件**
   ```
   下载 WeChatAutoManager.java 文件
   ```

2. **部署到插件目录**
   ```
   将文件复制到 WAuxiliary/plugins/ 目录下
   ```

3. **配置群组信息**
   ```
   ⚠️ 重要：必须修改代码中的群组ID配置（详见下方配置说明）
   ```

4. **重启WAuxiliary**
   ```
   重启WAuxiliary应用以加载新插件
   ```

5. **验证加载状态**
   ```
   插件加载后3秒内会在日志群自动发送启动日志
   ```

## ⚙️ 详细配置说明

> ⚠️ **重要提示**: 本插件代码中所有群组ID均为示例，使用前**必须**替换为您的真实群组ID。请按照以下步骤进行配置：

### 📱 核心群组配置（必须修改）

```java
// 日志输出群组（接收所有插件日志和状态报告）
// ⚠️ 必须修改：将"your_log_group_id"替换为您的真实日志群ID
config.put("LOG_GROUP_ID", "your_log_group_id@chatroom");

// 用户群组列表（用于邀请分配和群提示功能）
// ⚠️ 必须修改：将所有"your_groupX_id"替换为您的真实群组ID
String[] userGroups = {
    "your_group1_id@chatroom", // 群组1
    "your_group2_id@chatroom", // 群组2
    "your_group3_id@chatroom", // 群组3  
    "your_group4_id@chatroom"  // 群组4
};

// 群组友好名称映射
// ⚠️ 必须修改：更新群组ID和对应的群名称
Map groupNameMap = new HashMap();
groupNameMap.put("your_group1_id@chatroom", "群组1");
groupNameMap.put("your_group2_id@chatroom", "群组2");
groupNameMap.put("your_group3_id@chatroom", "群组3");
groupNameMap.put("your_group4_id@chatroom", "群组4");
groupNameMap.put("your_log_group_id@chatroom", "管理日志群");
```

### 🤝 好友管理配置（可选自定义）

```java
// 好友通过后的欢迎消息模板
config.put("WELCOME_MESSAGE", 
    "✨ 你好呀～很高兴通过你的好友申请！\n\n" +
    "有什么想问的或需要帮忙的，尽管说，不用太客气😉 我看到消息会第一时间回复～\n\n" +
    "🏎️ 想进群？回复「加群」就可以啦～\n\n" +
    "🤖 （本消息为自动回复）");
```

### 🎯 群邀请系统配置（可选自定义）

```java
// 核心邀请参数
// 可选修改：将"加群"修改为您需要的触发关键词
config.put("TRIGGER_KEYWORD", "加群");    // 触发关键词
config.put("MAX_GROUP_MEMBERS", 500);     // 群人数上限

// 用户反馈消息模板
config.put("CONFIRM_MESSAGE", 
    "📩 群聊邀请已发送，请注意查收。\n\n" +
    "❗ 温馨提示：由于微信群环境较为复杂，请您务必提高防范意识，切勿轻信涉及资金往来等操作。\n\n" +
    "📌 请关注我们的相关信息渠道，以防群聊被封后无法联系。\n\n" +
    "（本消息为自动回复）");

config.put("ERROR_MESSAGE", "抱歉，群聊邀请发送失败，请稍后重试。");
config.put("FULL_GROUP_MESSAGE", "抱歉，所有群组都已满员，暂时无法发送邀请，请稍后重试。");
```

### 💬 群成员提示配置（可选自定义）

```java
// 功能开关控制
config.put("ENABLE_JOIN_TIPS", true);     // 开启入群欢迎提示
config.put("ENABLE_LEFT_TIPS", false);    // 关闭退群告别提示
config.put("ENABLE_AT_USER", true);       // 开启@新成员功能

// 消息模板（支持变量替换）
config.put("JOIN_MESSAGE", 
    "[AtWx={userWxid}]\n" +
    "🎉 欢迎 {userName} 加入我们的大家庭！\n\n" +
    "📋 请阅读群公告，遵守群规\n" +
    "💬 如有问题可以私聊管理员\n\n" +
    "祝您在群里玩得开心！");

config.put("LEFT_MESSAGE", 
    "😢 {userName} 离开了群聊，我们会想念你的！\n\n" +
    "期待您再次回来！");
```

### 📋 日志系统配置（可选自定义）

```java
// 日志详细程度控制
config.put("ENABLE_DETAILED_LOG", true);  // 开启详细日志记录
```

### 🔍 如何获取群组ID

#### 方法1: 通过WAuxiliary控制台
1. 在目标群中发送任意消息
2. 查看WAuxiliary控制台日志
3. 找到`talker: 群ID@chatroom`格式的信息

#### 方法2: 通过临时调试代码
在插件中临时添加以下代码：
```java
void onHandleMsg(Object msgInfoBean) {
    if (msgInfoBean.isGroupChat()) {
        String groupId = msgInfoBean.getTalker();
        sendText(msgInfoBean.getTalker(), "当前群ID: " + groupId);
    }
}
```

#### 方法3: 使用/info命令
在配置好的日志群中输入`/info`，查看群组配置信息部分。

### 📝 完整配置示例

以下是一个完整的配置示例，请根据您的实际情况修改：

```java
Map getPluginConfig() {
    Map config = new HashMap();
    
    // 1. 替换为您的日志群ID
    config.put("LOG_GROUP_ID", "12345678901@chatroom");
    
    // 2. 替换为您的用户群组ID列表
    String[] userGroups = {
        "11111111111@chatroom", // 您的第1个群
        "22222222222@chatroom", // 您的第2个群
        "33333333333@chatroom", // 您的第3个群
        "44444444444@chatroom"  // 您的第4个群
    };
    config.put("USER_GROUPS", userGroups);
    
    // 3. 设置群名称映射
    Map groupNameMap = new HashMap();
    groupNameMap.put("11111111111@chatroom", "交流群1");
    groupNameMap.put("22222222222@chatroom", "交流群2");
    groupNameMap.put("33333333333@chatroom", "交流群3");
    groupNameMap.put("44444444444@chatroom", "交流群4");
    groupNameMap.put("12345678901@chatroom", "管理日志群");
    config.put("GROUP_NAME_MAP", groupNameMap);
    
    // 4. 设置触发关键词（可选修改）
    config.put("TRIGGER_KEYWORD", "进群");
    
    // 其他配置保持默认即可...
    return config;
}
```

### 变量说明
- `{userName}`: 自动替换为用户昵称
- `{userWxid}`: 自动替换为用户微信ID
- `[AtWx={userWxid}]`: @用户的语法格式

## 🎮 功能使用指南

### 🤝 好友申请自动处理
1. **触发条件**: 有人发送好友申请
2. **处理流程**: 
   - 自动通过好友申请
   - 等待2秒确保好友关系建立
   - 异步发送个性化欢迎消息
   - 记录处理过程到日志群
3. **日志输出**: 显示申请者信息、处理状态和欢迎消息发送结果

### 🎯 智能群邀请流程
1. **触发方式**: 用户向机器人发送私聊消息（默认关键词"加群"）
2. **智能处理**:
   - 随机检查配置的群组列表
   - 选择一个人数未满的群组（< 500人）
   - 发送群聊邀请给用户
   - 发送确认和注意事项消息
3. **异常处理**: 如所有群满员，发送相应提示消息
4. **日志记录**: 记录邀请过程、目标群组和处理结果

### 💬 群成员动态提示
1. **入群欢迎**:
   - 新成员加入时自动触发
   - @新成员并发送欢迎消息
   - 仅在配置的用户群组中生效
2. **退群提醒**:
   - 成员离开时自动触发（需开启ENABLE_LEFT_TIPS）
   - 发送告别消息
3. **变量替换**: 自动替换{userName}和{userWxid}为实际值

### 🆕 实时状态查询
1. **使用方法**: 在日志群中发送 `/info`
2. **功能特点**:
   - 实时获取最新群组人数信息
   - 显示完整的配置状态和统计数据
   - 无需等待功能触发，随时可查询
3. **权限要求**: 仅日志群成员可使用

## 📊 日志系统详解

### 🚀 插件启动日志示例
插件加载后3秒内自动发送：
```
#信息 2024-01-20 10:30:00 🚀 微信自动管理插件已启动

📋 插件版本: v1.0
⏰ 初始化时间: 2024-01-20 10:30:00

=== 🔧 功能配置状态 ===
好友自动通过: ✅ 启用
群邀请功能: ✅ 启用 (关键词: 加群)
入群提示: ✅ 启用
退群提示: ❌ 禁用
@用户功能: ✅ 启用
详细日志: ✅ 启用

=== 📊 群组配置信息 ===
日志群组: 管理日志群(your_log_group_id@chatroom)
群人数上限: 500 人
用户群组数量: 4 个

=== 🏘️ 用户群组列表及人员统计 ===
1. 群组1 - 人数: 450/500 (90%) 🟢 可用
2. 群组2 - 人数: 500/500 (100%) 🔴 已满
3. 群组3 - 人数: 320/500 (64%) 🟢 可用
4. 群组4 - 人数: 280/500 (56%) 🟢 可用

=== 📊 群组统计汇总 ===
总群数: 4 个
可用群: 3 个 🟢
已满群: 1 个 🔴
监控总人数: 1550 人
平均群人数: 387 人

=============================
✅ 插件初始化完成，所有功能已就绪！
```

### 🆕 /info 命令输出示例
在日志群输入 `/info` 后：
```
#信息 2024-01-20 15:20:35 🚀 📊 微信自动管理插件 - 当前状态信息

📋 插件版本: v1.0
⏰ 查询时间: 2025-01-01 15:20:35
🔧 命令触发: /info

=== 🔧 功能配置状态 ===
好友自动通过: ✅ 启用
群邀请功能: ✅ 启用 (关键词: 加群)
入群提示: ✅ 启用
退群提示: ❌ 禁用
@用户功能: ✅ 启用
详细日志: ✅ 启用

=== 📊 群组配置信息 ===
日志群组: 管理日志群(your_log_group_id@chatroom)
群人数上限: 500 人
用户群组数量: 4 个

=== 🏘️ 用户群组列表及人员统计 ===
1. 群组1 - 人数: 465/500 (93%) 🟢 可用
2. 群组2 - 人数: 500/500 (100%) 🔴 已满
3. 群组3 - 人数: 335/500 (67%) 🟢 可用
4. 群组4 - 人数: 290/500 (58%) 🟢 可用

=== 📊 群组统计汇总 ===
总群数: 4 个
可用群: 3 个 🟢
已满群: 1 个 🔴
监控总人数: 1590 人
平均群人数: 397 人

=============================
💡 提示: 输入 /info 可随时查看状态信息
```

### 📋 运行时日志示例
```
#信息 2024-01-20 10:35:22 检测到好友申请: wxid=user123, scene=1
#功能 2024-01-20 10:35:22 已自动通过好友申请: user123
#功能 2024-01-20 10:35:24 已发送欢迎消息给: user123

#信息 2024-01-20 10:40:15 检测到关键词触发 - 用户: user456, 关键词: 加群
#信息 2024-01-20 10:40:15 开始扫描所有群组，寻找可用的群...
#信息 2024-01-20 10:40:15 检查群组 1/4 - 群组1
#信息 2024-01-20 10:40:15 群组 群组1 当前人数: 456/500
#功能 2024-01-20 10:40:15 随机选择群组 - 群组1 (第1/3个, 人数: 456/500)
#功能 2024-01-20 10:40:16 群聊邀请发送成功 - 用户: user456, 目标群: 群组1(your_group1_id@chatroom)
#功能 2024-01-20 10:40:16 完整流程执行成功 - 用户: user456

#信息 2024-01-20 10:45:33 检测到成员变动 - 类型: join, 群: 群组1(your_group1_id@chatroom), 用户: 新用户 (newuser789)
#功能 2024-01-20 10:45:33 欢迎消息发送成功 - 群: 群组1(your_group1_id@chatroom), 用户: 新用户

#信息 2024-01-20 15:20:35 /info 命令执行完成
```

### 🔍 详细日志记录
当`ENABLE_DETAILED_LOG`开启时，还会记录详细信息：
```
#信息 2024-01-20 10:35:25 新好友申请
=== 详细好友申请信息 ===
时间: 2024-01-20 10:35:25
用户ID: user123
用户昵称: 张三
申请场景: 1
欢迎消息: ✨ 你好呀～很高兴通过你的好友申请！...
======================
```

## 🔧 高级自定义

### 修改群组配置
1. **添加新群组**:
   ```java
   // 在 USER_GROUPS 数组中添加新群ID
   "新群ID@chatroom"
   
   // 在 groupNameMap 中添加对应名称
   groupNameMap.put("新群ID@chatroom", "新群名称");
   ```

2. **移除群组**: 从数组和映射中删除对应条目

### 自定义消息模板
1. **支持的变量**:
   - `{userName}`: 用户昵称
   - `{userWxid}`: 用户微信ID
   
2. **@语法**: `[AtWx=用户wxid]`

3. **模板示例**:
   ```java
   config.put("JOIN_MESSAGE", 
       "[AtWx={userWxid}]\n" +
       "🎉 欢迎 {userName} 加入我们！\n" +
       "请先阅读群公告哦～");
   ```

### 功能开关配置
```java
// 根据需求调整这些开关
config.put("ENABLE_JOIN_TIPS", true);     // 入群提示
config.put("ENABLE_LEFT_TIPS", false);    // 退群提示
config.put("ENABLE_AT_USER", true);       // @新成员
config.put("ENABLE_DETAILED_LOG", true);  // 详细日志
```

## 🛡️ 重要注意事项

### 🔒 安全提醒
- ⚠️ **群组ID配置**: 所有示例群组ID必须替换为真实ID，否则插件无法正常工作
- ⚠️ **群组权限**: 确保机器人在目标群组中有发言和邀请权限
- ⚠️ **频率控制**: 注意消息发送频率，避免触发微信反垃圾机制
- ⚠️ **数据备份**: 定期备份配置文件，防止意外丢失

### 💡 最佳实践
- 🎯 **测试环境**: 新配置建议先在测试群组中验证
- 📊 **监控数据**: 定期使用`/info`命令查看群人员统计，及时调整配置
- 🔄 **异步处理**: 插件已实现异步处理，避免阻塞微信主进程
- 📝 **日志分析**: 通过日志分析插件运行状态和用户行为

### 🔧 故障排除

#### 插件未加载
- 检查文件路径: 确保文件在正确的plugins目录下
- 检查文件权限: 确保WAuxiliary有读取权限
- 检查语法错误: 确保Java代码语法正确

#### 日志未显示
- 检查LOG_GROUP_ID是否正确配置为真实群ID
- 确保机器人在日志群中且有发言权限
- 确认群ID格式：必须包含@chatroom后缀

#### 群邀请失败
- 检查USER_GROUPS中的群ID是否为真实群ID
- 确认机器人在目标群中有邀请权限
- 检查群人数是否已达上限

#### 群提示不生效
- 确认ENABLE_JOIN_TIPS/ENABLE_LEFT_TIPS开关状态
- 检查群组是否在USER_GROUPS列表中
- 确认机器人在群中有发言权限

#### /info命令无响应
- 确认在正确的日志群中发送命令
- 检查群ID配置是否正确
- 确认机器人有群消息接收权限

## 📈 技术特性

### 🔧 代码架构
- **模块化设计**: 功能模块清晰分离，易于维护
- **配置统一管理**: 所有配置集中在getPluginConfig()方法
- **异常处理**: 完整的try-catch机制，确保稳定性
- **异步处理**: 避免阻塞主线程，提升响应性能
- **代码重构**: 消除重复代码，提高可维护性

### 📊 性能优化
- **立即初始化**: 插件加载后立即显示完整状态信息
- **类型安全检查**: 配置项空值保护，提高健壮性
- **随机群选择**: 优化群选择算法，均衡分配群成员
- **错误隔离**: 单个功能异常不影响其他功能

### 🔄 兼容性
- **框架依赖**: 基于[WAuxiliary](https://github.com/HdShare/WAuxiliary_Public)框架开发
- **API规范**: 完全符合WAuxiliary Plugin API v1.2.3.r722.c2ba115规范
- **向前兼容**: 支持WAuxiliary v1.2.3及以上版本
- **错误恢复**: 具备自动错误恢复机制

## 📝 版本历史

### v1.0
- ✨ **初始版本发布**
- ✅ **好友自动管理**: 自动通过申请 + 欢迎消息
- ✅ **智能群邀请**: 关键词触发 + 随机群选择
- ✅ **群成员提示**: 入群欢迎 + 退群告别
- ✅ **完整日志系统**: 分级日志 + 详细记录
- ✅ **群名称映射**: 友好显示群名称
- ✅ **群人员监控**: 实时统计 + 状态分析
- ✅ **配置统一管理**: 集中配置 + 灵活开关
- ✅ **异步处理机制**: 性能优化 + 稳定性保障
- ✅ **立即启动日志**: 插件加载时立即显示完整信息
- ✅ **/info命令**: 实时状态查询功能
- ✅ **代码重构优化**: 消除重复代码，提高可维护性
- ✅ **类型安全增强**: 配置项空值检查和默认值处理
- ✅ **算法优化**: 群选择算法优化，支持随机分配

#### 📊 当前已实现的核心功能：
1. **🤝 智能好友管理**：
   - ✅ 自动通过好友申请
   - ✅ 异步发送个性化欢迎消息
   - ✅ 详细申请记录和日志

2. **🎯 智能群邀请系统**：  
   - ✅ 自定义关键词触发邀请
   - ✅ 随机检查群组，智能选择未满群
   - ✅ 实时人数检查（500人上限）
   - ✅ 确认消息和异常处理

3. **💬 群成员动态提示**：
   - ✅ 入群欢迎消息（支持@新成员）
   - ✅ 退群告别提醒（可配置开关）
   - ✅ 消息模板变量替换

4. **📊 完整监控日志系统**：
   - ✅ 三级分类日志（#信息、#功能、#报错）
   - ✅ 群名称友好映射显示
   - ✅ 详细操作记录和立即启动日志

5. **🆕 群人员监控功能**：
   - ✅ 实时人数统计和使用率分析
   - ✅ 状态可视化（🟢可用/🔴已满/❌异常）
   - ✅ 汇总统计（总群数、可用群、平均人数）

6. **🆕 实时状态查询**：
   - ✅ `/info`命令即时查看插件状态
   - ✅ 实时数据更新和完整状态报告

## 🤝 技术支持

### 问题反馈
如果遇到问题或有功能建议，请：

1. **检查配置**: 确认所有配置项正确设置，特别是群组ID配置
2. **查看日志**: 通过日志分析问题原因
3. **使用/info命令**: 检查插件当前状态
4. **测试环境**: 在小范围环境中复现问题
5. **提供信息**: 包含详细的错误信息和环境配置

### 功能建议
欢迎提出新功能建议：
1. 详细描述功能需求
2. 说明使用场景和价值
3. 提供实现思路（如有）

## 📄 开源协议

本项目采用 MIT 开源协议 - 查看 [LICENSE](LICENSE) 文件了解详情

## 🙏 致谢

- **[WAuxiliary](https://github.com/HdShare/WAuxiliary_Public) 开发团队**: 提供强大的微信辅助框架和插件开发平台
- **[HdShare](https://github.com/HdShare)**: WAuxiliary框架的主要开发者
- **开源社区**: 提供技术支持和最佳实践
- **所有用户**: 测试反馈和功能建议
